package application;

import java.io.File;
import java.io.IOException;
import java.net.MalformedURLException;
import java.util.List;

import javafx.scene.media.Media;
import javafx.scene.media.MediaPlayer;

import com.gargoylesoftware.htmlunit.*;
import com.gargoylesoftware.htmlunit.html.*;

public class Unit {

	public static int remindTime = 60;
	
	public static void main(String[] ags) throws FailingHttpStatusCodeException, MalformedURLException, IOException{
	
		final WebClient webClient = new WebClient();
		final HtmlPage page1 = webClient.getPage("http://idlast.com");
		
		HtmlTextInput user = (HtmlTextInput)page1.getElementByName("login");
		user.setValueAttribute("glaesarius");
		HtmlPasswordInput pass = (HtmlPasswordInput)page1.getElementByName("pass");
		pass.setValueAttribute("hmovfnde");
		 HtmlButton  rrr = (HtmlButton)page1.getByXPath("//button[@type='submit']").get(0);
		 final HtmlPage page2 = rrr.click();
		 
		 HtmlParagraph yourdellegend = (HtmlParagraph) page2.getByXPath("//div[@id='chatZaslPartOne']/div/p[2]").get(0);
		 HtmlDivision lastdellegend = (HtmlDivision) page2.getByXPath("//div[contains(@id,'dellegend')][last()]").get(0);
		 
		 String  yd = yourdellegend.asText();
		 String ld = lastdellegend.asText();
		 
		 String ydd = yd.split("¬ремени: ")[1];
		 System.out.println(ydd);
		 String ldd = ld.split(": ")[1].split(" ")[0];
		 System.out.println(ldd);
		 
		 System.out.println(toMinutes(ydd));
		 
		 int lastDelMin = Integer.parseInt(ldd);
		 int yourDelMin = toMinutes(ydd);
		 play();
		 if ((yourDelMin - lastDelMin) < remindTime){
			 play();
		 }
		 
		 //System.out.println(ttt.asText());
		 
		 //System.out.println(qqq.asText());
		 
		 
		 
	}
	
	private static int toMinutes(String data)
	{
		int result = 0;
		if (data.contains("дн."))
			result += Integer.parseInt(data.split("дн.")[0].trim()) * 1400; 
		if (data.contains("ч."))
			result += Integer.parseInt(data.split("дн.")[1].split("ч.")[0].trim()) * 60; 
		if (data.contains("мин.")){
			String[] d = data.trim().split(" ");
			result += Integer.parseInt(d[d.length-2]); 
		}
	     
		
		return result;
	}
	
	private static void play(){
		String bip = "bip.mp3";
		Media hit = new Media(new File(bip).toURI().toString());
		MediaPlayer mediaPlayer = new MediaPlayer(hit);
		mediaPlayer.play();
	}
}
